åˆ›å»º model

import { types } from "mobx-state-tree"

const Todo = types.model({
    name: "",
    done: false
})

åˆ›å»º model instances (tree nodes)

const eat = Todo.create({name: "eat", done: false})

æ³¨æ„å‚æ•°ç±»å‹éœ€è¦å’Œ model ä¸­ä¸€è‡´

at path "/done" value `1` is not assignable to type: `boolean`

åˆ›å»º model çš„å®Œæ•´è¯­æ³•æ˜¯

const Todo = types.model({
    name: types.optional(types.string, ""),
    done: types.optional(types.boolean, false)
})

types namespace æä¾›å¾ˆå¤šç±»å‹: 

  like array, map, maybe, refinements and unions

  https://mobx-state-tree.js.org/overview/types

å®šä¹‰ root model ä¿å­˜ Todo User 

const RootStore = types.model({
    users: types.map(User),
    todos: types.optional(types.map(Todo), {})
})

const store = RootStore.create({
    users: {} // users is not required really since arrays and maps are optional by default since MST3
})

å¦‚æœä½ æƒ³åœ¨ .create æ—¶ä¸ä¼ å‚æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦æä¾› types.optional ç¬¬äºŒä¸ªå‚æ•°ã€‚

å¦‚æœè¦ä½¿å¾— field å¿…é¡»æä¾›ï¼Œtypes.optional æ¢æˆ types.*

ä¿®æ”¹æ•°æ®

  using actions

  é€šè¿‡ .actions åœ¨ model ä¸Šå®šä¹‰

    ä¼ å…¥å‡½æ•°ï¼Œå‡½æ•°å‚æ•°ä¸º model instance è¿”å›ä¿®æ”¹åçš„å€¼

    self æ˜¯ åˆ›å»ºçš„ model instance

Snapshots are awesome

  mutable data å¥½ä¿®æ”¹ï¼Œä½†éš¾æµ‹è¯•

  immutable data å¥½æµ‹è¯•ï¼Œä½†éš¾ä¿®æ”¹

  å¦‚ä½•æ‹¥æœ‰åŒæ–¹çš„å¥½å¤„ï¼Ÿ

  generate serializable snapshots of our store

  get a snapshot of the store by using the getSnapshot function

  the nature of state is mutable, a snapshot will be emitted whenever the state is mutatedã€‚
  
  å½“ state æ”¹å˜æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª snapshot 

  ç›‘å¬æ–°çš„ snapshot 

    onSnapshot(store, snapshot => console.log(snapshot))

ä» snapshot åˆ° model 

  ç”¨ snapshot æ¢å¤ model, ä½ éœ€è¦çŸ¥é“ type of the tree and its snapshot

  æ–¹æ³•1: ç”¨ snapshot ä½œä¸ºå‚æ•°ï¼Œåˆ›å»º model instance, è¿™ä¼šæ›´æ–°æ‰€æœ‰çš„ reference

  æ–¹æ³•2: ä¸ºäº†é¿å…æ›´æ–° reference, applying the snapshot to an existing model instanceã€‚instance å±æ€§ä¼šæ›´æ–°ï¼Œä½† reference ä¸å˜ï¼Œè¿™ä¸€è¿‡ç¨‹å«åš reconciliation è°ƒå’Œ

Time travel
  snapshot å­˜å…¥ array 

Improving render performance
  ä¾‹å¦‚ map ä¸­ï¼Œå°† map çš„ç”Ÿæˆç»“æ„æŠ½å‡ºä¸º ç»„ä»¶

Computed properties
  
  .view(self => ({
    get pendingCount() {
      return values(self.todos).filter(todo => !todo.done).length
    },
    get completedCount() {}
  }))

  è®¡ç®—å±æ€§ï¼Œåªæœ‰ done å€¼å˜åŒ–æ‰ä¼šå¼•èµ·é‡æ–°è®¡ç®—

Model Views

  .view(self => ({
    getTodosWhereDoneIs(done) {
      return values(self.todos).filter(todo => todo.done === done)
    }
  }))

Reference 

  åœ¨ model ä¹‹é—´å¼•ç”¨

  åœ¨ User é‡Œæ·»åŠ è¯†åˆ«å±æ€§ id: types.identifier,

    types.identifier æ— æ³•è¢«ä¿®æ”¹ï¼Œcreate æ—¶å¿…é¡»æä¾›

  åœ¨ Todo model ä¸­ 

    user: types.maybe(types.reference(types.late(() => User)))

    types.maybe å…è®¸ user ref ä¸º null 

    ä¸º Todo è®¾ç½® user ref : æä¾› identifier æˆ– model instance

    å¦‚æœ User åœ¨ Todo ä¸­æœ‰å¼•ç”¨ï¼Œåˆ™æ— æ³•åˆ é™¤ User 

https://dev.to/margaretkrutikova/how-to-mobx-state-tree-react-typescript-3d5j#communicate-between-stores How to: mobx-state-tree + react + typescript - DEV Community ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»

https://medium.com/game-development-stuff/understanding-mobx-and-mobx-state-tree-7bd37f734789 Understanding MobX and MobX State Tree | by VerÃ³nica Valls | Game & Frontend Development Stuff | Medium

https://academind.com/learn/react/redux-vs-context-api/ Redux vs React's Context API
  React Context API ç”¨äºä½é¢‘å˜åŒ–