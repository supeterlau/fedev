Nest.js 


api test: httpie 

  http localhost:4000
  http :4000
  
[https://docs.nestjs.com/first-steps]

1. First steps

A progressive Node.js framework for building efficient, reliable and scalable server-side applications.

Installation

scaffold the project with the Nest CLI

> npm i -g @nestjs/cli 
æˆ–
> yarn global add @nestjs/cli

> nest new demo 
æˆ–
> npx nest new demo

src
  app.controller.ts       å•ä¸ªè·¯ç”± åŸºæœ¬æ§åˆ¶å™¨
  app.controller.spec.ts  æ§åˆ¶å™¨çš„å•å…ƒæµ‹è¯•
  app.module.ts           åº”ç”¨ root module 
  app.service.ts          åŸºæœ¬ service å‡½æ•°
  main.ts                 æ•´ä¸ªåº”ç”¨å…¥å£ï¼Œasync å‡½æ•°å¯åŠ¨åº”ç”¨ï¼Œä½¿ç”¨æ ¸å¿ƒå‡½æ•° NestFactory åˆ›å»º Nest application å®ä¾‹

NestFactory æœ‰ä¸€äº›é™æ€æ–¹æ³•å…è®¸åˆ›å»ºåº”ç”¨å®ä¾‹ã€‚ create() æ–¹æ³•è¿”å›ä¸€ä¸ªåº”ç”¨å¯¹è±¡ï¼Œå®ç° INestApplication æ¥å£ã€‚

Nest å¸Œæœ›æˆä¸ºå¹³å°æ— å…³æ¡†æ¶ã€‚Nest èƒ½å’Œä»»æ„ Node HTTP æ¡†æ¶åˆä½œï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ª adapterã€‚é»˜è®¤æ”¯æŒ express å’Œ fastifyã€‚

æ¥å£åˆ†åˆ«æ—¶ NestExpressApplication NestFastifyApplication

const app = await NestFactory.create<NestExpressApplication>(AppModule)

å¦‚æœæƒ³ä½¿ç”¨ fastify 

// src/main.ts
import {
  FastifyAdapter,
  NestFastifyApplication,
} from '@nestjs/platform-fastify';

async function bootstrap() {
  const app = await NestFactory.create<NestFastifyApplication>(
    AppModule,
    new FastifyAdapter(),
  );
  await app.listen(3000);
}

PORT=3030 npm run start 

PORT=3030 yarn start:dev

æµ‹è¯•è¯·æ±‚: 
  
  http :3030

2. Controllers

https://docs.nestjs.com/controllers

handling incoming requests å¤„ç†è¿›å…¥çš„è¯·æ±‚

returning responses to the client è¿”å›å“åº”æ•°æ®

routing mechanism æ§åˆ¶å“ªä¸ª controller å¤„ç†å“ªä¸ªè¯·æ±‚

Frequently, each controller has more than one route, and different routes can perform different actions.

  ä¸€ä¸ª controller ä¸­æœ‰å¤šä¸ª route 

- è·¯ç”± Routing

@Controller() è£…é¥°å™¨ç”¨äºåˆ›å»ºåŸºæœ¬è·¯ç”±
  å‚æ•°ä¸ºå¯é€‰çš„è·¯ç”±å‰ç¼€è·¯å¾„ optional route path prefix

åˆ›å»ºæ§åˆ¶å™¨æ–‡ä»¶ cats.controller.ts

é»˜è®¤è¿”å›æ•°æ® status code ä¸º 200ï¼Œå¯¹ POST è¯·æ±‚è¿”å› 201

Nest åªè¿”å› 200 å’Œ 201 ä¸¤ç§çŠ¶æ€ç 

ä¹Ÿå¯ä»¥ä½¿ç”¨ library-specific æ¥ä½¿ç”¨æ¡†æ¶åŸç”Ÿå“åº”å¯¹è±¡

  findAll(@Res() response)

  è¿”å›å€¼ response.status(200).send()

- è¯·æ±‚å¯¹è±¡ Request Object

åŒ…å«è¯·æ±‚ç»†èŠ‚

åªéœ€è¦åœ¨å¤„ç†å‡½æ•°ä¸­å¢åŠ  findAll(@Req() request: Request) @Req()

é»˜è®¤ä½¿ç”¨ express çš„ requestï¼Œéœ€è¦é¢å¤–å®‰è£… @types/express

@Req() è¡¨ç¤º HTTP request
  request query string, 
  parameters, 
  HTTP headers, 
  and body 

  @Request() @Req() (alias) -> req

  @Response() @Res() -> res 

  @Next() -> next

  @Session() -> req.session 

  @Param(key?: string) -> req.params ( req.params[key] )

  @Body(key?: string)

  @Query(key?: string)

  @Ip() -> req.ip 

  @HostParam() -> req.hosts 

ä¸€èˆ¬ä¸éœ€è¦æ‰‹åŠ¨è·å–ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”çš„ decorator 

- Resources

Nest æä¾›æ”¯æŒå„ç±» HTTP åŠ¨ä½œçš„è£…é¥°å™¨

@Get() 
@Post()
@Put()
@Delete()
@Patch()
@Options()
@Head()

@All()

- è·¯ç”±é€šé…ç¬¦ wildcards 

@Get('ab*cd')

æ”¯æŒæ­£åˆ™ ? + * ()

ç¬¦å· - å’Œ . æŒ‰ç…§å­—ç¬¦ä¸²è§£æ string-based

- çŠ¶æ€ç 
@HttpCode(204) (from '@nestjs/common')
create(){}

å¯ä»¥ä¿®æ”¹çŠ¶æ€ç ï¼Œä½†é€šå¸¸ä¸æ˜¯å›ºå®šçš„ã€‚å› æ­¤å¯ä»¥ç”¨ library-specific å“åº”å¯¹è±¡æˆ–æŠ›å‡ºå¼‚å¸¸

- Headers 

from '@nestjs/common'

@Post()
@Header('Cache-Control', 'none')

- é‡å®šå‘

@Redirect() æˆ–ç‰¹å®šæ–¹æ³•å¦‚ res.redirect()

@Redirect(url, [statusCode])
  url ç›®æ ‡åœ°å€
  statusCode é»˜è®¤ 302 

å¦‚æœè¦åŸºäºå“åº”å€¼é‡å®šå‘ï¼Œè¦åœ¨æ§åˆ¶å™¨å‡½æ•°ä¸­è¿”å› 

{
  'url': string,
  'statusCode': number
}

ä¼šè¦†ç›– @Redirect ä¸­å‚æ•°

- è·¯ç”±å‚æ•°

import from @nestjs/common 

@Get(':id') // å¯¹åº”è·¯ç”±ä¸­å‚æ•°ä¸º id /cats/1 id=1
findOne(@Param() params): string {
  console.log(params, params.id)
  return `return cat id: ${params.id}`
}

- å­åŸŸåæ”¯æŒ (åªæœ‰ express æ”¯æŒ)

Controller ç±»çš„è£…é¥°å™¨

@Controller({ host: ':account.example.com' }) :account è¡¨ç¤ºå˜é‡éƒ¨åˆ†

å¯¼å…¥ @HostParams('account') account: stringå¯ä»¥ç›´æ¥è·å¾— accout å€¼

- Scopes

NodeJS ä¸ç¬¦åˆ the request/response Multi-Threaded Stateless Model

è€Œæ˜¯ have a connection pool to the database, singleton services with global state, etc

using singleton instances is fully safe for our applications

https://docs.nestjs.com/fundamentals/injection-scopes

- å¼‚æ­¥å‡½æ•°

@Get()
async findAll(): Promise<any[]> {
  return []
}

æˆ–è€…è¿”å› Rxjs observable

@Get()
findAll(): Observable<any[]> {
  return of([]);
}

- è¯·æ±‚ä½“

@Body å¯ä»¥è·å–åˆ° post å‚æ•°

å¦‚æœä½¿ç”¨ TS é¦–å…ˆè¦ç¡®å®šæœ‰ DTO (Data Transfer Object)

DTO schema åŸºäº TS æ¥å£ interface æˆ–ç®€å•çš„ class æ¨èç”¨ class å¯ä»¥è¢«  preserved as real entities in the compiled JavaScript

åˆ›å»º CreateCatDto ç±» create-cat.dto.ts

åœ¨ CatsController é‡Œä½¿ç”¨ CreateCatDto

@Body() createCatDto: CreateCatDto

https://docs.nestjs.com/recipes/crud-generator

- é”™è¯¯å¤„ç†

https://docs.nestjs.com/exception-filters

- å¯ç”¨æ§åˆ¶å™¨

app.module.ts

import { CatsController } from './cats/cats.controller';

- Library-specific éƒ¨åˆ†

import { Response } from 'express';

æ—¢ä½¿ç”¨åº“ res åˆä¿ç•™ nest åŠŸèƒ½ passthrough: true

@Get()
findAll(@Res({ passthrough: true }) res: Response) {
  res.status(HttpStatus.OK);
  return [];
}


custom decorators

Nest CLI provides a generator (schematic)


å¼€å‘ç›¸å…³:

- çƒ­æ›´æ–°

PORT=3030 yarn start:dev

https://docs.nestjs.com/recipes/hot-reload Hot reload | NestJS - A progressive Node.js framework

nodemon

  By default nodemon monitors the current working directory

  nodemon --help config

  https://github.com/remy/nodemon/blob/master/doc/sample-nodemon.md

- API Auth

- OpenAPI


https://docs.nestjs.com/recipes/crud-generator CRUD generator | NestJS - A progressive Node.js framework


[https://www.codemag.com/Article/1907081/Nest.js-Step-by-Step]

give back-end developers a modular code structure and TypeScript experience to help build and maintain their large-scale enterprise Node.js apps without any serious issues

Heavily inspired by Angular

it makes use of Express.js but also provides compatibility with other libraries, like Fastify

1. generate basic nest.js app 

Modularization

group controllers + service providers

Controller 
  å¤„ç†è¯·æ±‚ï¼Œæ“ä½œæ•°æ®åº“ï¼Œè¿”å›ç»“æ„åŒ–ç»“æœ
  è£…é¥°å™¨ 
    @Controller(prefix?: string)
    @Get()

But first (if you use TypeScript), we need to determine the DTO (Data Transfer Object) schema. A DTO is an object that defines how the data will be sent over the network. å¯ç”¨ interface æˆ– class å®ç°ï¼Œæ¨èç”¨ class. å› ä¸º interface åœ¨è½¬è¯‘ä¸­ä¼šè¢«æŠ¹å»ã€‚ createCatDto: CreateCatDto

Provider
  å°è£…ç›¸å…³é€»è¾‘å’Œå‡½æ•°çš„ JavaScript ç±»
  controller å°†ä»»åŠ¡äº¤ç»™ provider è¿æ¥æ•°æ®åº“


Topic:

- ORM 

- Test 

- Swagger

- GraphQL 

Libs:
  https://github.com/nestjs/throttler nestjs/throttler: A rate limiting module for NestJS to work with Fastify, Express, GQL, Websockets, and RPC ğŸ§­ (api é™é€Ÿ)
  https://github.com/nestjs/terminus nestjs/terminus: Terminus module for Nest framework (node.js) (å¥åº·æ£€æŸ¥ healthcheck)
  https://github.com/angular/dgeni angular/dgeni: Flexible JavaScript documentation generator used by AngularJS, Protractor and other JS projects (æ–‡æ¡£ç”Ÿæˆ)
  https://github.com/nestjs/cqrs nestjs/cqrs: A lightweight CQRS module for Nest framework (node.js)
  https://martinfowler.com/bliki/CQRS.html# CQRS

  https://github.com/nartc/nest-mean nartc/nest-mean: NestJS Tutorial Repository

Refs:
  https://github.com/nestjs/docs.nestjs.com nestjs/docs.nestjs.com: The official documentation https://docs.nestjs.com ğŸ“•

  https://morioh.com/p/71f993016161 Build a web app using Nestjs, Fastify, MongoDB and Angular 8

https://handlebarsjs.com/